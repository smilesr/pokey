<!DOCTYPE html>
<html lang="en">
  <head>
    <title> Pokemon Table </title>
    <meta charset="utf-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style>
    .jumbotron {
      text-align: center;
    }
    .btn-select { 
      color: #ffffff; 
      background-color: pink; 
      border-color: black; 
    }
    .btn-ability { 
      color: #030000; 
      background-color: #EDE6E6; 
      border-color: #0E0D0F; 
      width: 100%;
      height: 100%;
    }  
 
}
    </style>


  </head>
  <body>
    <div class="container-fluid">
      <div class="jumbotron"> 
        <h1>POKEMON GENERATOR</h1>
              <button type="button" class="btn btn-select">Pick a Pokemon</button>
      </div>

      <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>Name</th>
        <th>Base Experience</th>
        <th>Abilities</th>
        <th>Moves</th>
    </thead>
    <tbody>     
    </tbody>
  </table>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
    const butt = document.querySelector('button');
    const tableContainer = document.querySelector('tbody');
    const pokemonList = {};
    console.log('global')


    function getPokemon(){
      console.log('run getPokemon')
      let randomNumber = getRandom();
      let httpRequest = new XMLHttpRequest();
      httpRequest.onreadystatechange = function()
       {
        console.log("readystate: " + this.readyState)
        if (this.readyState == 4 && this.status == 200)
          {
            let response = JSON.parse(this.responseText);
            let pokemonName = response.name;
            pokemonList[pokemonName] = {
              "experience": response.base_experience,
              "abilities": getAbilities(response),
              "moves": getMoves(response)
            }
            addRow();
            insertPokeInfo(pokemonName);
            console.log('bing bong')    
          }
        }
        httpRequest.open("GET","http://pokeapi.co/api/v2/pokemon/" + randomNumber, true);
        httpRequest.send();
      
    }
    function addRow(){
      let row = tableContainer.insertRow(-1);
      for (let i = 0; i<4; i++){
        row.insertCell(-1);
      }
    }
    function insertPokeInfo(name){
      let target = tableContainer.lastChild;
     
      target.children[0].innerHTML = titleCase(name);
      target.children[1].innerHTML = pokemonList[name].experience;
      let abilityLinks = createAnchorTags(pokemonList[name].abilities)
      
     
 
      let movesButtons = createAttributeButtons(pokemonList[name].moves)
      let counter = 0;
      for (let key in abilityLinks){
        target.lastChild.previousElementSibling.appendChild(abilityLinks[key]);
        
        if (counter !== Object.keys(abilityLinks).length-1){
          let node = document.createTextNode(" / ");
          target.lastChild.previousElementSibling.appendChild(node);
        }
        counter += 1;
        
      }
      for (let i=0; i<movesButtons.length; i++){
        target.appendChild(movesButtons[i]);
      }

    }
    function createAttributeButtons(attributes){
      let buttons = [];
      for (let i = 0; i<attributes.length; i++){
        let button = document.createElement("button");
        button.innerHTML = attributes[i];
        buttons.push(button);
      }  
      return buttons;
    }
    function titleCase(name) {
      console.log('inside titleCase')
      return name.charAt(0).toUpperCase() + name.slice(1);
    }
    function createAnchorTags(abilities){
      console.log('inside createAnchorTags')
      let anchorTagList = {};
      abilities.forEach(function(ability){

        let link = createAbilityLink(ability);
        let anchor = document.createElement("a");
        anchor.innerHTML = ability;
        anchor.setAttribute("href",link);
        anchorTagList[ability] = anchor;

      })
      console.log(anchorTagList);
      return anchorTagList;
    }
    function createAbilityLink(ability){
      console.log('inside createAbilityLink')
        let abilityName = titleCase(ability);
        abilityName = abilityName.replace(/-/, '_');
        let link = "https://bulbapedia.bulbagarden.net/wiki/" + abilityName + "_(Ability)";
        console.log('link: ' + link)
        return link;
    }
    function getAbilities(obj){
      console.log('run abil')
      let list = [];
      let aList = obj.abilities;
      for (let i in aList){
        list.push(aList[i].ability.name);
      }
      return list;
    }
    function getMoves(obj){
      console.log('run mov')
      let list = [];
      let mList = obj.moves;
      for (let i in mList){
        list.push(mList[i].move.name);
      }
       return list.slice(0,5);
    }
    function getRandom(){
      console.log('run getRandom')
      let min = Math.ceil(1);
      let max = Math.floor(711);
      return Math.floor(Math.random() * (max - min)) + min;
    }
    butt.addEventListener('click', getPokemon);
    </script>
  </body>
</html>